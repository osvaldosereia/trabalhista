<!-- Intro -->
<section id="intro" class="card big">
  <h1>Portials — Petições Iniciais Trabalhistas</h1>
  <p class="lead">Fluxo 100% manual com sugestões guiadas. Sem upload de documentos e sem uso de IA.</p>
  <div class="row gap">
    <button id="btnIniciar" class="primary">Começar novo caso</button>
    <button id="btnLoadDraft" class="secondary">Abrir rascunho</button>
    <button id="btnReset" class="ghost">Resetar app</button>
  </div>
</section>

<!-- Wizard -->
<section id="wizard" class="hidden">
  <div class="wizard-head">
    <ol id="stepsList" class="steps">
      <li class="active">Juízo</li>
      <li>Partes</li>
      <li>Contrato</li>
      <li>Fatos</li>
      <li>Pedidos</li>
      <li>Fundamentos & Provas</li>
      <li>Blocos</li>
      <li>Valores</li>
      <li>Revisão</li>
    </ol>
    <div id="progress" class="progress"><span style="width:0%"></span></div>
  </div>

  <form id="formPeticao" class="stack">

    <!-- 0 Juízo -->
    <fieldset class="step card">
      <legend>Juízo</legend>
      <div class="grid">
        <label>Nº da Vara (opcional)
          <input type="text" id="juizoNum" placeholder="Ex.: 5ª"/>
        </label>
        <label>Cidade
          <input type="text" id="cidade" placeholder="Ex.: São Paulo" required/>
        </label>
        <label>UF
          <input type="text" id="uf" maxlength="2" placeholder="SP" required/>
        </label>
      </div>
    </fieldset>

    <!-- 1 Partes -->
    <fieldset class="step card hidden">
      <legend>Partes</legend>
      <h3>Reclamante</h3>
      <div class="grid">
        <label>Nome <input id="reclamante_nome" required></label>
        <label>Estado civil <input id="reclamante_estado_civil"></label>
        <label>Profissão <input id="reclamante_prof"></label>
        <label>CPF <input id="reclamante_cpf"></label>
        <label>RG <input id="reclamante_rg"></label>
        <label>E-mail <input id="reclamante_email" type="email"></label>
        <label>Telefone <input id="reclamante_tel"></label>
        <label>CEP <input id="reclamante_cep"></label>
        <label>Endereço <input id="reclamante_end"></label>
      </div>

      <div class="row between">
        <h3>Reclamada(s)</h3>
        <button id="addReclamada" type="button" class="mini">+ adicionar reclamada</button>
      </div>
      <div id="reclamadasWrap" class="stack">
        <div class="card subtle reclamada">
          <div class="grid">
            <label>Razão social / Nome <input name="reclamada_nome" required></label>
            <label>CNPJ/CPF <input name="reclamada_doc"></label>
            <label>Endereço <input name="reclamada_end"></label>
            <label>E-mail <input name="reclamada_email" type="email"></label>
            <label>Telefone <input name="reclamada_tel"></label>
            <label>CEP <input name="reclamada_cep"></label>
          </div>
          <div class="row end"><button type="button" class="mini danger btnRemoveReclamada">remover</button></div>
        </div>
      </div>
    </fieldset>

    <!-- 2 Contrato -->
    <fieldset class="step card hidden">
      <legend>Contrato</legend>
      <div class="grid">
        <label>Admissão <input type="date" id="adm"></label>
        <label>Saída <input type="date" id="saida"></label>
        <label>Função <input id="funcao"></label>
        <label>Salário (R$) <input id="salario" placeholder="0,00"></label>
        <label>Jornada <input id="jornada" placeholder="Ex.: 8h/d, 44h/sem"></label>
        <label>Controle de ponto <input id="controlePonto" placeholder="Ex.: manual/eletrônico/none"></label>
        <label>Desligamento <input id="desligamento" placeholder="Ex.: sem justa causa, pedido de demissão"></label>
      </div>
    </fieldset>

    <!-- 3 Fatos (manual com catálogo amplo) -->
    <fieldset class="step card hidden">
      <legend>Fatos</legend>

      <div class="row gap">
        <label style="min-width:260px">Tema principal
          <select id="temaSelect"></select>
        </label>
        <button type="button" class="mini" id="btnSugFatos">Inserir sugestões de Fatos</button>
        <button type="button" class="mini" id="btnSugNarr">Inserir sugestões de Narrativa</button>
      </div>

      <div class="grid">
        <label>Sugestões rápidas (selecione e dê duplo clique para inserir)
          <select id="fatosSug" multiple size="10"></select>
        </label>
        <label>Narrativa (edição manual)
          <textarea id="fatos" rows="12" placeholder="Descreva a narrativa fática..."></textarea>
        </label>
      </div>

      <details class="card subtle" style="margin-top:8px">
        <summary>Catálogo adicional de sugestões de fatos (rápido)</summary>
        <div class="grid">
          <label>Horas extras
            <textarea rows="6" readonly class="mono">• Jornada superior a 8h/44h sem pagamento integral.
• Intervalo intrajornada suprimido total/parcial.
• Ponto britânico/por exceção não reflete a realidade.
• Compensação/banco de horas inválidos.
• Labor em domingos/feriados sem folga compensatória.</textarea>
          </label>
          <label>Intervalos
            <textarea rows="6" readonly class="mono">• Concessão parcial do intervalo intrajornada (20–30min).
• Intervalo interjornada (11h) descumprido em escalas.
• Intervalos semanais suprimidos/irregulares.</textarea>
          </label>
          <label>Adicional noturno
            <textarea rows="6" readonly class="mono">• Labor após 22h sem adicional devido.
• Hora noturna reduzida não observada (52m30s).
• Prorrogação do noturno em período diurno sem adicional correto.</textarea>
          </label>
          <label>Rescisão/FGTS
            <textarea rows="6" readonly class="mono">• Atrasos reiterados de salários.
• Ausência de depósitos de FGTS.
• Descumprimento contratual grave (art. 483 CLT).</textarea>
          </label>
          <label>Insalubridade/Periculosidade
            <textarea rows="6" readonly class="mono">• Exposição a agentes nocivos acima dos limites (NR-15).
• Contato com inflamáveis/eletricidade sem proteção (NR-16).
• EPIs insuficientes/ineficazes; treinamentos ausentes.</textarea>
          </label>
          <label>Teletrabalho/Sobreaviso
            <textarea rows="6" readonly class="mono">• Disponibilidade constante via celular/app fora do expediente.
• Respostas obrigatórias em janelas de plantão (restrição real).</textarea>
          </label>
        </div>
        <small class="muted">Dica: copie trechos e cole na narrativa ao lado, ajustando datas, horários e períodos.</small>
      </details>
    </fieldset>

    <!-- 4 Pedidos -->
    <fieldset class="step card hidden">
      <legend>Pedidos</legend>
      <div class="row gap">
        <button type="button" class="mini" id="btnSugPedidos">Inserir sugestões de Pedidos</button>
        <button id="addPedido" type="button" class="mini">+ pedido</button>
      </div>
      <div id="pedidoChips" class="chips"></div>
      <div id="pedidosWrap" class="stack"></div>
    </fieldset>

    <!-- 5 Fundamentos & Provas (sem upload) -->
    <fieldset class="step card hidden">
      <legend>Fundamentos & Provas</legend>
      <div class="grid-2">
        <div>
          <div class="row gap">
            <button type="button" class="mini" id="btnSugFund">Inserir sugestões de Fundamentos</button>
          </div>
          <label>Fundamentos (um por linha)
            <textarea id="fundamentos" rows="12" placeholder="Ex.: CLT art. 58; CF/88 art. 7º; Súmula x/TST; OJ y/SDI-I..."></textarea>
          </label>
        </div>
        <div>
          <div class="row between">
            <label>Provas (lista manual)</label>
            <!-- Upload removido -->
          </div>
          <div id="provasWrap" class="stack"></div>
          <div class="row">
            <button id="addProva" type="button" class="mini">+ prova</button>
          </div>
          <div class="muted">
            Descreva apenas as provas que pretende juntar (ex.: holerites, cartões de ponto, contrato, comunicações).
          </div>
        </div>
      </div>
    </fieldset>

    <!-- 6 Blocos (apenas checkboxes; sem template PDF) -->
    <fieldset class="step card hidden">
      <legend>Blocos</legend>
      <div class="grid">
        <label>Tipo de Ação
          <select id="tipoAcao">
            <option value="">— selecione —</option>
            <option value="horas_extras">Horas Extras</option>
            <option value="intervalo">Intervalo Intrajornada</option>
            <option value="adicional_noturno">Adicional Noturno</option>
            <option value="rescisao_indireta">Rescisão Indireta</option>
            <option value="equiparacao">Equiparação Salarial</option>
            <option value="insalubridade">Insalubridade</option>
            <option value="periculosidade">Periculosidade</option>
          </select>
        </label>
      </div>
      <div class="stack" style="margin-top:8px">
        <label class="check"><input type="checkbox" class="blk" value="reflexos" checked> Reflexos (DSR, 13º, férias + 1/3, FGTS + 40%)</label>
        <label class="check"><input type="checkbox" class="blk" value="multa_477"> Multa 477 CLT</label>
        <label class="check"><input type="checkbox" class="blk" value="fgts40"> FGTS + 40%</label>
      </div>
      <small class="muted">Use os blocos para lembrar dos pedidos acessórios mais comuns.</small>
    </fieldset>

    <!-- 7 Valores (manual) -->
    <fieldset class="step card hidden">
      <legend>Valores</legend>
      <div class="muted" style="margin-bottom:8px">Insira os valores estimados por pedido. O total será somado automaticamente.</div>
      <div id="valoresWrap" class="stack"></div>
      <div class="total">Valor da Causa: <strong id="valorCausa">R$ 0,00</strong></div>
      <div class="row gap" style="margin-top:8px">
        <label class="check"><input type="checkbox" id="justicaGratuita"> Requer justiça gratuita</label>
        <label class="check"><input type="checkbox" id="honorarios"> Requer honorários (art. 791-A)</label>
      </div>
    </fieldset>

    <!-- 8 Revisão -->
    <fieldset class="step card hidden">
      <legend>Revisão</legend>
      <pre id="review" class="review"></pre>
      <ul id="lintList" class="lint"></ul>
      <div class="row gap">
        <button id="btnSalvar" type="button" class="ghost">Salvar rascunho</button>
        <button id="btnForense" type="button" class="ghost">Atualizar prévia</button>
      </div>
    </fieldset>
  </form>

  <div class="wizard-foot row between">
    <div class="row gap">
      <button id="btnPrev" class="secondary">Voltar</button>
      <button id="btnNext" class="primary">Avançar</button>
    </div>
    <div class="row gap">
      <button id="btnGerar" class="primary">Gerar Prompt</button>
      <!-- Removido: Gerar com ChatGPT -->
    </div>
  </div>
</section>

<!-- Resultado -->
<section id="resultado" class="hidden">
  <div class="toolbar row between">
    <div class="row gap">
      <button id="voltar" class="secondary">← Voltar</button>
      <button id="exportPdf" class="ghost">Exportar PDF</button>
      <button id="exportDocx" class="ghost">Exportar DOCX</button>
      <button id="btnExportJson" class="ghost">Exportar JSON do caso</button>
      <button id="btnImportJson" class="ghost">Importar JSON</button>
    </div>
  </div>

  <div class="grid-2-tall">
    <div class="panel">
      <h3>Prompt completo</h3>
      <textarea id="saida" rows="26" class="mono"></textarea>
      <div class="row end gap">
        <button id="copiar" class="secondary">Copiar prompt</button>
      </div>
    </div>
    <div class="panel">
      <h3>Prévia forense (HTML)</h3>
      <div id="previewDoc" class="preview"></div>
      <div class="row end gap" style="margin-top:8px">
        <button id="copyHtml" class="ghost">Copiar HTML</button>
        <button id="printDoc" class="secondary">Imprimir</button>
      </div>
    </div>
  </div>
</section>

<script>
  // binds apenas para sugestões (sem IA/sem upload/sem jurisprudência)
  document.addEventListener('click', (e)=>{
    if (e.target?.id==='btnSugFatos') window.Clara.catalog?.pushSuggestions('fatos');
    if (e.target?.id==='btnSugNarr') window.Clara.catalog?.pushSuggestions('narrativa');
    if (e.target?.id==='btnSugFund') window.Clara.catalog?.pushSuggestions('fundamentos');
    if (e.target?.id==='btnSugPedidos') window.Clara.catalog?.pushSuggestions('pedidos');
  });
  // lista múltipla com duplo clique é tratada em catalog.js
</script>
